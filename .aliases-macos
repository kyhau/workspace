#!/bin/bash
# Set aliases for some generic scripts

WORKSPACE_REPO_HOME="$(dirname "$(readlink -f "$0")")"

################################################################################
# codeql

# alias codeql-resolve-languages='codeql resolve languages'
# alias codeql-resolve-packs='codeql resolve packs'
# alias codeql-database-create-python='codeql database create --language=python'
# alias codeql-database-upgrade='codeql database upgrade'
# alias codeql-database-upgrade-python='codeql database upgrade --language=python'
# alias codeql-database-analyze='codeql database analyze --format sarif-latest --output output.sarif'

################################################################################
# docker

alias docker-images-prune='docker images prune'
alias docker-rm-exited='docker rm $(docker ps -q -f status=exited)'
alias docker-rmi-all='docker rmi -f $(docker images -aq)'
alias docker-rmi-dangling='docker rmi $(docker images -f "dangling=true" -q)'
alias docker-secret-list='docker secret list'
alias docker-system-prune-a='docker system prune -a'

################################################################################
# git / gh

alias git-branch-default='gh repo view --json defaultBranchRef --jq .defaultBranchRef.name'
alias git-branch-current='git branch --show-current'
alias git-branch-rename-main2master='git branch -m main master && git push -u origin master && git push origin -d main'
alias git-branch-rename-master2main='git branch -m master main && git push -u origin main && git push origin -d master'

alias git-chmod='sh -c '\''git update-index --chmod="$@"'\'' _'
alias git-config-core-ignorecase-false='git config core.ignorecase false'
alias git-config-core-ignorecase-true='git config core.ignorecase true'
alias git-config-fileMode-false='git config core.fileMode false'
alias git-config-fileMode-true='git config core.fileMode true'
alias git-config-list='git config --list'
alias git-config-show-user='git config user.name && git config user.email'
alias git-fetch='git -c diff.mnemonicprefix=false -c core.quotepath=false --no-optional-locks fetch --prune origin'
alias git-secrets-list-config-current-repo='git secrets --list'
alias git-secrets-list-config-global='git secrets --list --global'
alias git-secrets-scan='git secrets --scan -r'
alias git-secrets-scan-history='git secrets --scan-history'

alias git-rm-reflog='git reflog expire --expire=now --all'

alias git-pull-all='bash ${WORKSPACE_REPO_HOME}/tools/git/run_git_pull.sh'
alias git-repo-latest-release='bash ${WORKSPACE_REPO_HOME}/tools/github/get_github_repo_latest_release.sh'
alias git-repo-latest-tag='bash ${WORKSPACE_REPO_HOME}/tools/github/get_github_repo_latest_tag.sh'
alias git-squash-new-start='bash ${WORKSPACE_REPO_HOME}/tools/git/squash_all_git_commits_into_latest.sh'

alias git-checkout--='git checkout -- .'
alias git-checkout-default='git checkout $(git-branch-default)'

alias git-clean-dfx='git clean -dfx'

alias git-ls-branch-all='bash ${WORKSPACE_REPO_HOME}/tools/git/run_git_branch.sh'
alias git-ls-files='git ls-files'
alias git-ls-files-untracked='git ls-files --others --exclude-standard'

alias gh-aliases='gh alias list'
alias gh-aliases-reimport='gh alias import --clobber ${WORKSPACE_REPO_HOME}/.aliases-gh.yml'
alias gh-extension-list='gh extension list'

alias gh-api-rate-limit='gh api -H "Accept: application/vnd.github.v3+json" /rate_limit'
alias gh-oidc-thumbprint-for-actions='bash ${WORKSPACE_REPO_HOME}/tools/github/get_github_oidc_thumbprint_for_actions.sh'
alias gh-oidc-thumbprint-for-audit-log='bash ${WORKSPACE_REPO_HOME}/tools/github/get_github_oidc_thumbprint_for_audit_log.sh'

alias gh-auth-login='gh auth login'
alias gh-auth-setup-git='git auth setup-git'
alias gh-auth-status='gh auth status'
alias gh-switch='gh auth switch'
alias gh-login-current='gh api /user | jq .login'

alias gh-pr-create='gh pr create --assignee @me --fill'
alias gh-pr-merge-squash='gh pr merge --squash'
alias gh-delete-workflow-runs='python3 ${WORKSPACE_REPO_HOME}/tools/github/gh_delete_workflow_runs.py'
alias gh-force-cancel-workflow-runs='python3 ${WORKSPACE_REPO_HOME}/tools/github/gh_force_cancel_workflow_runs.py'

alias git-auto-commit-merge='git add . && git commit -m "Updated" && git push'

alias git-auto-branch='bash ${WORKSPACE_REPO_HOME}/tools/git/git-auto-branch.sh'
alias git-auto-pr-merge='bash ${WORKSPACE_REPO_HOME}/tools/git/git-auto-pr-merge.sh'
alias git-auto-commit-pr-merge='bash ${WORKSPACE_REPO_HOME}/tools/git/git-auto-commit-pr-merge.sh'
alias git-auto-ci-all-changes='bash ${WORKSPACE_REPO_HOME}/tools/git/git-auto-ci-all-changes.sh'

################################################################################
# gitleaks

alias gitleaks-detect='gitleaks detect --report-path gitleaks-report.json'

################################################################################
# go

# alias go-build='go build'
# alias go-clean-modcache='go clean -modcache'
# alias go-get-aws='go get github.com/aws/aws-sdk-go-v2 && go get github.com/aws/aws-sdk-go-v2'
# alias go-install='go install'
# alias go-mod-init='go mod init'
# alias go-mod-tidy='go mod tidy'
# alias go-run='go run'
# alias go-test='go test -v'

################################################################################
# npm

alias npm-audit='npm audit'
alias npm-audit-fix='npm audit fix'
alias npm-audit-signatures='npm audit signatures'
alias npm-install='npm install'

################################################################################
# nvm

alias nvm-install-latest='nvm install node --reinstall-packages-from=node'
alias nvm-install-latest-lts='nvm install --lts'
alias nvm-install-latest-npm='nvm install-latest-npm'
alias nvm-ls='nvm ls'
alias nvm-ls-remote-lts-14='nvm ls-remote --lts=Fermium'
alias nvm-ls-remote-lts-16='nvm ls-remote --lts=Gallium'
alias nvm-ls-remote-lts-18='nvm ls-remote --lts=Hydrogen'
alias nvm-use-latest='nvm use node'
alias nvm-use-latest-lts='nvm use --lts'
alias nvm-use-system='nvm use system'
alias nvm-which-current='nvm which current'

################################################################################
# pre-commit

alias pre-commit-install='pre-commit install'

################################################################################
# q

alias q-agent-validate='q agent validate'
alias q-agent-list='q agent list'
alias q-chat-agent='q chat --agent'
alias q-mcp-list='q mcp list'
alias q-mcp-status='q mcp status --name'
alias q-settings='q settings'

################################################################################
# trufflehog

# alias trufflehog-filesystem='trufflehog filesystem'
# alias trufflehog-git-only-verified='trufflehog git -only-verified --json'

################################################################################
# yarn

# see https://thomaschaplin.medium.com/how-to-fix-yarn-audit-issues-ff5840f712d1
alias yarn-audit-fix='npm i --package-lock-only && rm yarn.lock && npm audit fix && yarn import && rm package-lock.json'
alias yarn-upgrade='yarn upgrade'

################################################################################
# rm-

alias rm-cache='bash ${WORKSPACE_REPO_HOME}/scripts/sh/cleanup_cache.sh'
alias rm-cache-apt='sudo du -sh /var/cache/apt && sudo apt-get clean'
alias rm-dev-env='bash ${WORKSPACE_REPO_HOME}/scripts/sh/cleanup_dev_env.sh'

################################################################################
# synk

alias snyk-code-test='snyk code test'
alias snyk-monitor='snyk monitor -d -insecure --all-projects --fail-fast --strict-out-of-sync=true --detection-depth=6'
alias snyk-test='snyk test --all-projects --fail-fast --detection-depth=6'
alias snyk-run-all='bash ${WORKSPACE_REPO_HOME}/tools/snyk/run-snyk.sh'

################################################################################
# Update apps/packages

alias update-brew='brew update'
alias update-brew-packages='brew upgrade && brew cleanup'

alias update-copilot-cli='npm install -g @github/copilot'

alias update-dev-env='bash ${WORKSPACE_REPO_HOME}/macos/update-dev-env.sh'

alias update-git-sizer='bash ${WORKSPACE_REPO_HOME}/tools/git/install_git_sizer.sh'

alias update-typescript='sudo npm i -g typescript && echo "INFO: tsc version: $(tsc --version)"'

alias update-q='q update'

alias update-serverless='bash ${WORKSPACE_REPO_HOME}/tools/install_serverless.sh'

################################################################################
# custom scripts or commands

alias k-degreen='bash ${WORKSPACE_REPO_HOME}/scripts/sh/degreen.sh'

alias k-dos2unix='find . -type f ! -iname "*.ps1" ! -name "*.bat" ! -path "*/.git/*" ! -path "*/.idea/*" ! -path "*/node_modules/*" -print0 | xargs -0 dos2unix'

alias k-grep='sh -c '\''grep -R --exclude-dir=.git --exclude-dir=cdk.out --exclude-dir=dist --exclude-dir=node_modules "$@"'\'' _'

alias k-rename-files='python3 ${WORKSPACE_REPO_HOME}/scripts/py/rename_files.py'

alias k-copy-rules='python3 ${WORKSPACE_REPO_HOME}/tools/rules-helper/copy_rules.py'

####
# System

alias k-du-hs='du -hs'
alias k-du-h-max-depth-1='du -h --max-depth=1'
alias k-df-h='df -h'

####
# Conversion

alias k-oidc-thumbprint='bash ${WORKSPACE_REPO_HOME}/tools/oidc/get_oidc_thumbprint.sh'
alias k-pem2crt='_func(){ openssl x509 -inform PEM -in "$1" -out $(basename "${1%.*}.crt"); }; _func'
alias k-timestamp2datetime='function _(){ if [[ -z "$1" ]]; then echo "Missing timestamp"; else date -d@$1; fi; }; _'

####
# Linting

alias k-yamllint='yamllint -d "{extends: default, rules: {document-start: disable, line-length: disable, truthy: disable}}" -f parsable .'

####
# ls

alias k-ls-common-ip-protocols='cat ${WORKSPACE_REPO_HOME}/quick-notes/common-ip-protocols.txt'
alias k-ls-common-ip-ranges='cat ${WORKSPACE_REPO_HOME}/quick-notes/common-ip-ranges.txt'
alias k-ls-common-ports='cat ${WORKSPACE_REPO_HOME}/quick-notes/common-ports.txt'
alias k-ls-mult-byte-units='cat ${WORKSPACE_REPO_HOME}/quick-notes/multi-byte-units.txt'
alias k-ls-timezones='bash ${WORKSPACE_REPO_HOME}/scripts/sh/ls_timezones.sh'

####
# Networking

alias k-ip-in-range-check='python3 ${WORKSPACE_REPO_HOME}/tools/networking/is_ip_in_range.py'

# what the outside world thinks your ip address is
# or curl ifconfig.me
# https://askubuntu.com/questions/430853/how-do-i-find-my-internal-ip-address
alias k-ip-external='curl --silent http://checkip.amazonaws.com'
# what your computer thinks its ip address is
alias k-ip-local='bash ${WORKSPACE_REPO_HOME}/ubuntu/get_local_ip.sh'

alias k-whatismy-ipaddress='browser https://whatismyipaddress.com/'
alias k-whatismy-proxy='browser http://www.whatismyproxy.com/'

alias k-disable-apt-ocsp-verification='bash ${WORKSPACE_REPO_HOME}/ubuntu/disable_apt_ocsp_verification.sh'
alias k-reset-apt-ocsp-verification='bash ${WORKSPACE_REPO_HOME}/ubuntu/reset_apt_ocsp_verification.sh'
